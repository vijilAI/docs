<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html"><link rel="next" title="Evaluation Reports" href="reports.html"><link rel="prev" title="Custom Harnesses" href="custom-harness.html">
        <link rel="prefetch" href="../../_static/vijil_wide.png" as="image">

    <link rel="shortcut icon" href="https://assets-global.website-files.com/656632658074164265ceea17/6570d66fa750acafb3a837ac_favicon.png"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Evaluating Agents with Custom Endpoints - Vijil Docs</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Vijil Docs</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/vijil_wide.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Evaluating Agents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="agents.html">Add, Update, and Delete Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-keys.html">Managing API keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluations.html">Evaluations</a></li>
<li class="toctree-l2"><a class="reference internal" href="owasp.html">OWASP LLM Top 10 Harness</a></li>
<li class="toctree-l2"><a class="reference internal" href="rag.html">RAG metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="detections.html">Working with Detections</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-harness.html">Custom Harnesses</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Evaluating Agents with Custom Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Evaluation Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="playground.html">Playground</a></li>
<li class="toctree-l2"><a class="reference internal" href="cicd.html">Integrating Vijil Evaluate into CI/CD</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../integrations/index.html">Integrations</a><input aria-label="Toggle navigation of Integrations" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/vertex.html">Google Vertex AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/digitalocean.html">DigitalOcean</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/bedrock.html">AWS Bedrock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/custom.html">Custom Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/local.html">Local LLMs and Agents</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tests-library/index.html">Dimensions of Trust</a><input aria-label="Toggle navigation of Dimensions of Trust" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/hallucination.html">Hallucination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/robustness.html">Robustness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/toxicity.html">Toxicity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/stereotype.html">Stereotype</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/fairness.html">Fairness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/ethics.html">Ethics</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../components/index.html">Trust Score Components</a><input aria-label="Toggle navigation of Trust Score Components" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../components/harnesses.html">Harnesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../components/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../components/probes.html">Probes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../components/detectors.html">Detectors</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../glossary/index.html">Glossary</a><input aria-label="Toggle navigation of Glossary" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../glossary/detectors.html">Detector Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary/probes.html">Probe Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Protecting Agents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dome/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/config.html">Configuring Guardrails</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dome/guards/index.html">List of Detection Methods</a><input aria-label="Toggle navigation of List of Detection Methods" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/moderation.html">Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/integrity.html">Integrity</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dome/tutorials/index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/guardrails.html">Using Guardrails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/domed-clients.html">Applying Dome to Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/langchain.html">Langchain Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/adk.html">Google ADK Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/custom-detectors.html">Custom Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/observability.html">Observability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/integrations.html">Integrations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Enterprise Deployment of Evaluate</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise_deployment/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise_deployment/pre-requisites.html">Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise_deployment/deploying.html">Deploying Vijil Evaluate with Helm</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/evaluate/examples/local-agent-evaluations.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="evaluating-agents-with-custom-endpoints">
<h1>Evaluating Agents with Custom Endpoints<a class="headerlink" href="#evaluating-agents-with-custom-endpoints" title="Link to this heading">¶</a></h1>
<p>Vijil Evaluate lets you evaluate agents that are hosted on popular LLM and Agent cloud service providers. If you don’t have an agent hosted on any of these <a class="reference internal" href="../../integrations/index.html"><span class="std std-doc">hubs</span></a>, you can use the Vijil Python Client to evaluate any agent you have access to with just a few lines of code. The Vijil client can automatically spin up an endpoint for your agent, allowing you to use to test it just like you would any other model.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>To get started, make sure you have the following:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../../quickstart.html"><span class="std std-doc">A Vijil client</span></a>. In this topic we’ll assume you’ve instantiated a Vijil client called <code class="docutils literal notranslate"><span class="pre">client</span></code>.</p></li>
<li><p>An agent you want to evaluate</p></li>
<li><p>If you are not a Vijil Premium user, <a class="reference external" href="https://dashboard.ngrok.com/get-started/setup/pythonhttps://dashboard.ngrok.com/get-started/setup/python">an Ngrok Authorization Token</a></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: We use Ngrok to create private, protected endpoints to your agent. If you’re on a Free plan, you’ll need to get an Ngrok authorization token. If you’re subscribed to the premium version of Vijil, you don’t need to worry about this - we take care of it for you.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>IMPORTANT: Due to how Jupyter handles event loops, we do NOT recommend running this code in a Jupyter notebook. Please run it in a regular Python .py script</p>
</div>
</section>
<section id="step-1-create-a-local-agent-executor">
<h2>Step 1 - Create a Local Agent Executor<a class="headerlink" href="#step-1-create-a-local-agent-executor" title="Link to this heading">¶</a></h2>
<p>In order to make your agent compatible with Vijil’s APIs, you need to create an input_adapter and an output_adapter. Like the names imply, the input_adapter transforms a ChatCompletionRequest from Vijil, into an input that your agent expects, while the output_adapter converts your agent’s output into a response that Vijil expects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">vijil.local_agents.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChatCompletionRequest</span><span class="p">,</span>
    <span class="n">ChatCompletionResponse</span><span class="p">,</span>
    <span class="n">ChatCompletionChoice</span><span class="p">,</span>
    <span class="n">ChatMessage</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The expected output signature of this function depends on what your Agent needs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">example_input_adapter</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ChatCompletionRequest</span><span class="p">):</span>
    <span class="c1"># Extract whatever data you need from the request</span>
    <span class="c1"># Here we just take the last message content as the prompt</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>

<span class="c1"># The expected input signature of this function depends on your agent&#39;s output</span>
<span class="k">def</span><span class="w"> </span><span class="nf">example_output_adapter</span><span class="p">(</span><span class="n">agent_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatCompletionResponse</span><span class="p">:</span>
    <span class="c1"># First create a message object</span>
    <span class="c1"># You can populate tool call and retrieval context if needed</span>
    <span class="n">agent_response_message</span> <span class="o">=</span> <span class="n">ChatMessage</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> 
        <span class="n">content</span><span class="o">=</span><span class="n">agent_output</span><span class="p">,</span> 
        <span class="n">tool_calls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">retrieval_context</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># next create a choice object to support multiple completions if needed</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">ChatCompletionChoice</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">message</span><span class="o">=</span><span class="n">agent_response_message</span><span class="p">,</span> 
        <span class="n">finish_reason</span><span class="o">=</span><span class="s2">&quot;stop&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Finally, return the response</span>
    <span class="k">return</span> <span class="n">ChatCompletionResponse</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;my-agent&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">choice</span><span class="p">],</span>
        <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># You can track usage as well</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Once you have an input and output adapter, create an instance of the <code class="docutils literal notranslate"><span class="pre">LocalAgentExecutor</span></code> class using the client’s <code class="docutils literal notranslate"><span class="pre">agents.create</span></code> method, your adapters and your agent’s main function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vijil</span> <span class="o">=</span> <span class="n">Vijil</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VIJIL_API_KEY&quot;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">local_agent</span> <span class="o">=</span> <span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">agent_function</span><span class="o">=</span><span class="n">my_agent_function</span><span class="p">,</span>
    <span class="n">input_adapter</span><span class="o">=</span><span class="n">example_input_adapter</span><span class="p">,</span>
    <span class="n">output_adapter</span><span class="o">=</span><span class="n">example_output_adapter</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">LocalAgentExecutor</span></code> can support any function if the input and output adapters are built correctly, so you can use it to evaluate an agent written in any framework, or hosted on any platform!</p>
</section>
<section id="step-2-evaluate">
<h2>Step 2 - Evaluate!<a class="headerlink" href="#step-2-evaluate" title="Link to this heading">¶</a></h2>
<p>After creating the <code class="docutils literal notranslate"><span class="pre">LocalAgentExecutor</span></code>, use the <code class="docutils literal notranslate"><span class="pre">local_agents.evaluate</span></code> method to evaluate your agent. We spin up an authenticated ephemeral endpoint for your agent that can only communicate with Vijil Evaluate. This enables us to evaluate your agent without you needing to deploy it beforehand.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;My Agent&quot;</span><span class="p">,</span> <span class="c1"># This is the name of your agent to use in the evaluation</span>
    <span class="n">evaluation_name</span><span class="o">=</span><span class="s2">&quot;Evaluating my agent on Ethics&quot;</span><span class="p">,</span> <span class="c1"># The name of your evaluation</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">local_agent</span><span class="p">,</span> <span class="c1"># The LocalAgentExecutor you created earlier</span>
    <span class="n">harnesses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ethics_Small&quot;</span><span class="p">],</span> <span class="c1"># The harnesses you wish to run</span>
    <span class="n">rate_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="c1"># Maximum number of requests in the interval to send to your agent</span>
    <span class="n">rate_limit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># The size of the interval for the rate_limit (in minutes)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This method will automatically create the endpoint, register it and begin the evaluation. You will see live progress of your evaluation while it runs, and you can cancel it midway any time by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">C</span></code></p>
<p><img alt="Report generation progress" src="../../_images/local_evaluation_creation.gif" /></p>
<p>If you’re a power user, you can register your agent with Evaluate, trigger an evaluation via the registered url, and then shut down the server when you’re done. This method is not recommended for most users because it requires you to manage the server lifecycle.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">vijil.local_agents.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">TERMINAL_STATUSES</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">server</span><span class="p">,</span> <span class="n">api_key_name</span> <span class="o">=</span> <span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;my-agent&quot;</span><span class="p">,</span>
    <span class="n">evaluator</span><span class="o">=</span><span class="n">local_agent</span><span class="p">,</span>
    <span class="n">rate_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">rate_limit_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">evaluation</span> <span class="o">=</span> <span class="n">vijil</span><span class="o">.</span><span class="n">evaluations</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model_hub</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;local-agent&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test local agent&quot;</span><span class="p">,</span>
    <span class="n">api_key_name</span><span class="o">=</span><span class="n">api_key_name</span><span class="p">,</span>
    <span class="n">model_url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">server</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">/v1&quot;</span><span class="p">,</span>
    <span class="n">harnesses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;trust_score&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Wait for a bit to let the evaluation start</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluation </span><span class="si">{</span><span class="n">evaluation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> started.&quot;</span><span class="p">)</span>

<span class="c1"># Keep your server alive till the evaluation is done</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">status_data</span> <span class="o">=</span> <span class="n">vijil</span><span class="o">.</span><span class="n">evaluations</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">evaluation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">status_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">TERMINAL_STATUSES</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluation </span><span class="si">{</span><span class="n">evaluation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> finished with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Don&#39;t forget to shut down the server when you&#39;re done :)</span>
<span class="n">vijil</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">deregister</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">api_key_name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<p>Here are some examples of how you can use this feature to evaluate agents built using some popular frameworks</p>
<section id="langchain">
<h3>Langchain<a class="headerlink" href="#langchain" title="Link to this heading">¶</a></h3>
<p>The code snippet below showcases how you can evaluate an agent built using Langchain</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># These first imports are just what your agent requires</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">SystemMessage</span><span class="p">,</span> <span class="n">HumanMessage</span>

<span class="c1"># These are the imports you need to add for Evaluations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">vijil.local_agents.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChatCompletionRequest</span><span class="p">,</span>
    <span class="n">ChatCompletionResponse</span><span class="p">,</span>
    <span class="n">ChatCompletionChoice</span><span class="p">,</span>
    <span class="n">ChatMessage</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">vijil</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vijil</span>


<span class="c1"># Lets make a simple agent using langchain for this example</span>
<span class="n">chat</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">streaming</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># This is the agent you want to evaluate</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cool_langchain_agent</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">SystemMessage</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="s2">&quot;You are a cool assistant 😎. Always be cool and use cool emojis like 😎&quot;</span>
        <span class="p">),</span>
        <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">chat</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>


<span class="c1"># Now we define the input and output adapters for your agent to work with Vijil Evaluate</span>


<span class="k">def</span><span class="w"> </span><span class="nf">example_input_adapter</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ChatCompletionRequest</span><span class="p">):</span>
    <span class="c1"># Extract whatever data you need from the request</span>
    <span class="c1"># Here we just take the last message content as the prompt</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">example_output_adapter</span><span class="p">(</span><span class="n">agent_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># First create a message object</span>
    <span class="c1"># You can populate tool call and retrieval context if needed</span>
    <span class="n">agent_response_message</span> <span class="o">=</span> <span class="n">ChatMessage</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">agent_output</span><span class="p">,</span> <span class="n">tool_calls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retrieval_context</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># next create a choice object to support multiple completions if needed</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">ChatCompletionChoice</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">agent_response_message</span><span class="p">,</span> <span class="n">finish_reason</span><span class="o">=</span><span class="s2">&quot;stop&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Finally, return the response</span>
    <span class="k">return</span> <span class="n">ChatCompletionResponse</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;my-new-model&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">choice</span><span class="p">],</span>
        <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># You can track usage if needed</span>
    <span class="p">)</span>


<span class="c1"># That&#39;s all you need! Now just connect your agent and run the evaluation</span>
<span class="c1"># Before you begin, sign up for an ngrok account at https://ngrok.com/</span>
<span class="c1"># Set your ngrok auth token as NGROK_AUTHTOKEN in your environment variables</span>
<span class="c1"># see here to find your token: https://dashboard.ngrok.com/get-started/setup/python</span>
<span class="c1"># You can skip this step if you&#39;re a Premium user</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;NGROK_AUTHTOKEN&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please set your ngrok auth token as NGROK_AUTHTOKEN in your environment variables.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Step 1: Create a LocalAgentExecutor instance to run your agent locally</span>
    <span class="n">vijil</span> <span class="o">=</span> <span class="n">Vijil</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VIJIL_API_KEY&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">local_agent</span> <span class="o">=</span> <span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">agent_function</span><span class="o">=</span><span class="n">cool_langchain_agent</span><span class="p">,</span>
        <span class="n">input_adapter</span><span class="o">=</span><span class="n">example_input_adapter</span><span class="p">,</span>
        <span class="n">output_adapter</span><span class="o">=</span><span class="n">example_output_adapter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Step 2: Evaluate your agent! Lets see how ethical our Cool Agent is!</span>
    <span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
        <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;local-cool-agent&quot;</span><span class="p">,</span>
        <span class="n">evaluation_name</span><span class="o">=</span><span class="s2">&quot;test local cool agent&quot;</span><span class="p">,</span>
        <span class="n">agent</span><span class="o">=</span><span class="n">local_agent</span><span class="p">,</span>
        <span class="n">harnesses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ethics_Small&quot;</span><span class="p">],</span>
        <span class="n">rate_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">rate_limit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="google-agent-development-kit-adk">
<h3>Google Agent Development Kit (ADK)<a class="headerlink" href="#google-agent-development-kit-adk" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://google.github.io/adk-docs/#what-is-agent-development-kit">Google ADK</a> is a popular and flexible new framework to develop agents. Evaluating agents built using ADK is very straightforward and uses the same steps as before.</p>
<p>In this example, we’ll use the sample Travel Concierge agent from ADK’s sample agents. This is a multi-agent workflow and involves multiple agent-to-agent interactions, but we can test the entire workflow’s reliability, safety and security without needing to worry about the underlying components of the agent. We just need to create an instance of the <code class="docutils literal notranslate"><span class="pre">LocalAgentExecutor</span></code> class that we can run an evaluation on.</p>
<p>To create the agent executor, we first create an ADK runner which lets us interact with the agent as a standalone function</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">google.adk.sessions</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySessionService</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">google.adk.runners</span><span class="w"> </span><span class="kn">import</span> <span class="n">Runner</span>

<span class="c1"># This is the agent we want to use for the demo</span>
<span class="c1"># You can find it at https://github.com/google/adk-samples/tree/main/agents/travel-concierge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">travel_concierge.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">root_agent</span> <span class="k">as</span> <span class="n">travel_agent</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">google.genai</span><span class="w"> </span><span class="kn">import</span> <span class="n">types</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="c1"># Load up your API keys</span>
<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># We&#39;ll now create a local session for the agent to run in</span>
<span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>

<span class="c1"># These variables are used to identify your service - they do not matter</span>
<span class="n">APP_NAME</span> <span class="o">=</span> <span class="s2">&quot;Travel Concierge Agent&quot;</span>
<span class="n">USER_ID</span> <span class="o">=</span> <span class="s2">&quot;user_1&quot;</span>
<span class="n">SESSION_ID</span> <span class="o">=</span> <span class="s2">&quot;session_001&quot;</span> 

<span class="c1"># Create the specific session where the conversation will happen</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
    <span class="n">app_name</span><span class="o">=</span><span class="n">APP_NAME</span><span class="p">,</span>
    <span class="n">user_id</span><span class="o">=</span><span class="n">USER_ID</span><span class="p">,</span>
    <span class="n">session_id</span><span class="o">=</span><span class="n">SESSION_ID</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session created: App=&#39;</span><span class="si">{</span><span class="n">APP_NAME</span><span class="si">}</span><span class="s2">&#39;, User=&#39;</span><span class="si">{</span><span class="n">USER_ID</span><span class="si">}</span><span class="s2">&#39;, Session=&#39;</span><span class="si">{</span><span class="n">SESSION_ID</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="c1"># Now create your runner</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">travel_agent</span><span class="p">,</span> <span class="c1"># The agent we want to run</span>
    <span class="n">app_name</span><span class="o">=</span><span class="n">APP_NAME</span><span class="p">,</span>   <span class="c1"># Associates runs with our app</span>
    <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span> <span class="c1"># Uses our session manager</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runner created for agent &#39;</span><span class="si">{</span><span class="n">runner</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

<span class="c1"># This function is what runs a single query string on the agent</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_agent_async</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">runner</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Sends a query to the agent and prints the final response.&quot;&quot;&quot;</span>
  <span class="c1"># Prepare the user&#39;s message in ADK format</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">query</span><span class="p">)])</span>

  <span class="n">final_response_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># Default</span>

  <span class="c1"># Key Concept: run_async executes the agent logic and yields Events.</span>
  <span class="c1"># We iterate through events to find the final answer.</span>
  <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">content</span><span class="p">):</span>
      <span class="c1"># is_final_response() marks the concluding message for a turn.</span>
      <span class="c1"># Some agents, like this one, can have multiple final response messages, so we concatenate them in this example</span>
      <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">():</span>
          <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
             <span class="n">final_response_text</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
          <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">actions</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">escalate</span><span class="p">:</span> <span class="c1"># Handle potential errors/escalations</span>
             <span class="n">final_response_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Agent escalated: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">error_message</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;No specific message.&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        
  <span class="k">return</span> <span class="n">final_response_text</span> <span class="ow">or</span> <span class="s2">&quot;The agent did not respond.&quot;</span>

<span class="c1"># Finally, we create our agent function </span>
<span class="c1"># This function is now a standalone function that can be used with Vijil Evaluate</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_agent</span><span class="p">(</span><span class="n">query</span> <span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
   <span class="k">return</span> <span class="k">await</span> <span class="n">call_agent_async</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">runner</span><span class="p">,</span> <span class="n">USER_ID</span><span class="p">,</span> <span class="n">SESSION_ID</span><span class="p">)</span>

</pre></div>
</div>
<p>We can now create the <code class="docutils literal notranslate"><span class="pre">LocalAgentExecutor</span></code> using the <code class="docutils literal notranslate"><span class="pre">run_agent</span></code> function and run our evaluation</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">vijil.local_agents.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChatCompletionRequest</span><span class="p">,</span>
    <span class="n">ChatCompletionResponse</span><span class="p">,</span>
    <span class="n">ChatCompletionChoice</span><span class="p">,</span>
    <span class="n">ChatMessage</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">vijil</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vijil</span>

<span class="k">def</span><span class="w"> </span><span class="nf">input_adapter</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ChatCompletionRequest</span><span class="p">):</span>
    <span class="c1"># Since our agent doesn&#39;t support or expect system prompts, lets combine all the prompts into one</span>
    <span class="n">message_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
       <span class="n">message_str</span> <span class="o">+=</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">message_str</span>


<span class="k">def</span><span class="w"> </span><span class="nf">output_adapter</span><span class="p">(</span><span class="n">agent_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># Our agent has a lot of tracing and extra data, but the only user facing message is the final response text</span>
    <span class="n">agent_response_message</span> <span class="o">=</span> <span class="n">ChatMessage</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> 
        <span class="n">content</span><span class="o">=</span><span class="n">agent_output</span><span class="p">,</span> 
        <span class="n">tool_calls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">retrieval_context</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># next create a choice object to support multiple completions if needed</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">ChatCompletionChoice</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">message</span><span class="o">=</span><span class="n">agent_response_message</span><span class="p">,</span> 
        <span class="n">finish_reason</span><span class="o">=</span><span class="s2">&quot;stop&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Finally, return the response</span>
    <span class="k">return</span> <span class="n">ChatCompletionResponse</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;travel-concierge&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">choice</span><span class="p">],</span>
        <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># You can track usage if needed</span>
    <span class="p">)</span>

<span class="n">vijil</span> <span class="o">=</span> <span class="n">Vijil</span><span class="p">(</span>
   <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VIJIL_API_KEY&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">local_agent</span> <span class="o">=</span> <span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">agent_function</span><span class="o">=</span><span class="n">run_agent</span><span class="p">,</span>
    <span class="n">input_adapter</span><span class="o">=</span><span class="n">input_adapter</span><span class="p">,</span>
    <span class="n">output_adapter</span><span class="o">=</span><span class="n">output_adapter</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Evaluate your agent!</span>
<span class="n">vijil</span><span class="o">.</span><span class="n">local_agents</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;ADK Travel Concierge&quot;</span><span class="p">,</span>
    <span class="n">evaluation_name</span><span class="o">=</span><span class="s2">&quot;ADK Travel Concierge Security Testing&quot;</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">local_agent</span><span class="p">,</span>
    <span class="n">harnesses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;security_Small&quot;</span><span class="p">],</span>
    <span class="n">rate_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">rate_limit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="reports.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Evaluation Reports</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="custom-harness.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Custom Harnesses</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Vijil Inc
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Evaluating Agents with Custom Endpoints</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#step-1-create-a-local-agent-executor">Step 1 - Create a Local Agent Executor</a></li>
<li><a class="reference internal" href="#step-2-evaluate">Step 2 - Evaluate!</a></li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#langchain">Langchain</a></li>
<li><a class="reference internal" href="#google-agent-development-kit-adk">Google Agent Development Kit (ADK)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    </body>
</html>