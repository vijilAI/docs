<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html"><link rel="next" title="Working with Detections" href="detections.html"><link rel="prev" title="Testing OWASP LLM Top 10 Vulnerabilities" href="owasp.html">
        <link rel="prefetch" href="../../_static/vijil_wide.png" as="image">

    <link rel="shortcut icon" href="https://assets-global.website-files.com/656632658074164265ceea17/6570d66fa750acafb3a837ac_favicon.png"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Evaluating RAGs through Vijil Evaluate - Vijil Docs</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Vijil Docs</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/vijil_wide.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Evaluating Agents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="agents.html">Add, Update, and Delete Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-keys.html">Managing API keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluations.html">Evaluations</a></li>
<li class="toctree-l2"><a class="reference internal" href="owasp.html">OWASP LLM Top 10 Harness</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">RAG metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="detections.html">Working with Detections</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-harness.html">Custom Harnesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="local-agent-evaluations.html">Evaluating Agents with Custom Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Evaluation Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="playground.html">Playground</a></li>
<li class="toctree-l2"><a class="reference internal" href="cicd.html">Integrating Vijil Evaluate into CI/CD</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../integrations/index.html">Integrations</a><input aria-label="Toggle navigation of Integrations" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/vertex.html">Google Vertex AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/digitalocean.html">DigitalOcean</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/bedrock.html">AWS Bedrock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/custom.html">Custom Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/local.html">Local LLMs and Agents</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tests-library/index.html">Dimensions of Trust</a><input aria-label="Toggle navigation of Dimensions of Trust" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/hallucination.html">Hallucination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/robustness.html">Robustness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/toxicity.html">Toxicity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/stereotype.html">Stereotype</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/fairness.html">Fairness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tests-library/ethics.html">Ethics</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../components/index.html">Trust Score Components</a><input aria-label="Toggle navigation of Trust Score Components" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../components/harnesses.html">Harnesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../components/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../components/probes.html">Probes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../components/detectors.html">Detectors</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../glossary/index.html">Glossary</a><input aria-label="Toggle navigation of Glossary" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../glossary/detectors.html">Detector Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary/probes.html">Probe Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Protecting Agents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dome/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/config.html">Configuring Guardrails</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dome/guards/index.html">List of Detection Methods</a><input aria-label="Toggle navigation of List of Detection Methods" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/moderation.html">Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/guards/integrity.html">Integrity</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dome/tutorials/index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/guardrails.html">Using Guardrails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/domed-clients.html">Applying Dome to Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/langchain.html">Langchain Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/adk.html">Google ADK Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/custom-detectors.html">Custom Detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dome/tutorials/observability.html">Observability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dome/integrations.html">Integrations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Enterprise Deployment of Evaluate</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise_deployment/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise_deployment/pre-requisites.html">Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise_deployment/deploying.html">Deploying Vijil Evaluate with Helm</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/evaluate/examples/rag.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="evaluating-rags-through-vijil-evaluate">
<h1>Evaluating RAGs through Vijil Evaluate<a class="headerlink" href="#evaluating-rags-through-vijil-evaluate" title="Link to this heading">¶</a></h1>
<p>Retrieval Augmented Generation (RAG) is a popular framework for building generative AI applications, where the user can supply queries into a chat interface and get answers back related to a specific knowledge base typically composed od chunked documents.</p>
<p>There are two stages of generating an answer through a RAG:</p>
<ol class="arabic simple">
<li><p><strong>Retrieval</strong>: a vector search is performed in a knowledge base, and top-k document chunks are retrieved that are closest to the input query per distance in the embedding space.</p></li>
<li><p><strong>Generation</strong>: Retrieved contexts and the original question are supplied to a Large Language Model (LLM), which generates the final answer for the end user.</p></li>
</ol>
<p>Vijil Evaluate enables you to evaluate LLMs for RAG capabilities. Given a set of questions, the list of contexts each question would yield based on vector search from knowledge base, and the ground truth (or ‘golden’) answers to the questions, Vijil Evaluate uses a number of metrics to evaluate the quality of retrieved contexts, the quality of generated answers from the LLM component, as well as the likelihood that a generated answer is a hallucination.</p>
<p>Vijil Evaluate currently supports seven metrics to evaluate the generation stage in a RAG pipeline. In this notebook, we show you how to implement these metrics.</p>
<section id="retrieval-metrics">
<h2>Retrieval Metrics<a class="headerlink" href="#retrieval-metrics" title="Link to this heading">¶</a></h2>
<p>To measure the quality of the retrieved contexts, we use two LLM-based metrics. Each produce a score between 0 and 1.</p>
<ul class="simple">
<li><p><strong>Contextual Precision</strong>: measures whether the contexts relevant to the input question are ranked higher in the full set of retrieved contexts than irrelevant ones. A higher score indicates greater alignment in ranking.</p></li>
<li><p><strong>Contextual Recall</strong>: measures the extent to which the retrieved contexts align with the golden answers. A higher score indicates greater alignment with the golden answer.</p></li>
</ul>
<p>Currently, we use <code class="docutils literal notranslate"><span class="pre">gpt-4o</span></code> as the judge LLM in these metrics.</p>
</section>
<section id="generation-metrics">
<h2>Generation Metrics<a class="headerlink" href="#generation-metrics" title="Link to this heading">¶</a></h2>
<p>Our generation metrics are divided into three categories, attempting to measure the LLM in a RAG for different capabilities.</p>
<section id="correctness">
<h3>Correctness<a class="headerlink" href="#correctness" title="Link to this heading">¶</a></h3>
<p>To measure correctness of the LLM-generated answers, we use the following traditional NLP metrics.</p>
<ul class="simple">
<li><p>BLEU</p></li>
<li><p>METEOR</p></li>
<li><p>BERTScore</p></li>
</ul>
<p>Each of them compares the similarity of an LLM-generated answer with the ground truth ‘golden’ answer, and provides a score between 0 and 1. A higher score indicates greater similarity to the golden answer.</p>
</section>
<section id="relevancy">
<h3>Relevancy<a class="headerlink" href="#relevancy" title="Link to this heading">¶</a></h3>
<p>Our LLM-based Answer Relevancy metric measures the degree to which the final generated output is relevant to the original input. It produces a score between 0 and 1, higher score indicating higher relevancy.</p>
</section>
<section id="hallucination">
<h3>Hallucination<a class="headerlink" href="#hallucination" title="Link to this heading">¶</a></h3>
<p>We use an LLM-based Faithfulness metric to measure how much the generated response stays faithful to the retrieved contexts, i.e. the opposite of hallucination. This metric produces scores from 0 to 1, where a higher score means that the response is more faithful to the context (has fewer hallucinations).</p>
</section>
</section>
<section id="evaluating-domain-specific-question-answering">
<h2>Evaluating Domain-specific Question Answering<a class="headerlink" href="#evaluating-domain-specific-question-answering" title="Link to this heading">¶</a></h2>
<p>In the example below, we use the <a class="reference external" href="https://huggingface.co/datasets/PatronusAI/financebench">FinanceBench</a> benchmark dataset to evaluate how accurately  <code class="docutils literal notranslate"><span class="pre">gpt-4o-mini</span></code> can produce reliable answers from a dataset of financial documents.</p>
<p>Note that our Python client uses an API token, loaded as the environment variable <code class="docutils literal notranslate"><span class="pre">VIJIL_API_KEY</span></code>. Please make sure you have <a class="reference external" href="https://docs.vijil.ai/setup.html#authentication-using-api-keys">fetched an API key</a> from the UI and stored it in the env file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install vijil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="s2">&quot;../.env&quot;</span><span class="p">)</span>

<span class="c1"># import and instantiate the client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">vijil</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vijil</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Vijil</span><span class="p">()</span>
</pre></div>
</div>
<p>FinanceBench already exists as an evaluation harness in Vijil Evaluate. Now we simply create an evaluation of the given LLM on this harness.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">evaluation</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">evaluations</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model_hub</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">model_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="n">harnesses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;financebench&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span>
<span class="c1"># {&#39;id&#39;: &#39;726285f8-ec61-431b-9673-8ec722707031&#39;, &#39;status&#39;: &#39;CREATED&#39;}</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">get_status</span></code> method to keep track of the progress of the evaluation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">evaluations</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">evaluation_id</span><span class="o">=</span><span class="n">evaluation</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
<span class="c1"># {&#39;id&#39;: &#39;726285f8-ec61-431b-9673-8ec722707031&#39;,</span>
<span class="c1">#  &#39;name&#39;: &#39;openai-gpt-4o-mini&#39;,</span>
<span class="c1">#  &#39;tags&#39;: [&#39;&#39;],</span>
<span class="c1">#  &#39;status&#39;: &#39;IN_PROGRESS&#39;,</span>
<span class="c1">#  &#39;total_test_count&#39;: 20,</span>
<span class="c1">#  &#39;completed_test_count&#39;: 0,</span>
<span class="c1">#  &#39;error_test_count&#39;: 0,</span>
<span class="c1">#  &#39;total_response_count&#39;: 0,</span>
<span class="c1">#  &#39;completed_response_count&#39;: 0,</span>
<span class="c1">#  &#39;error_response_count&#39;: 0,</span>
<span class="c1">#  &#39;total_generation_time&#39;: None,</span>
<span class="c1">#  &#39;average_generation_time&#39;: None,</span>
<span class="c1">#  &#39;score&#39;: None,</span>
<span class="c1">#  &#39;hub&#39;: &#39;openai&#39;,</span>
<span class="c1">#  &#39;model&#39;: &#39;gpt-4o-mini&#39;,</span>
<span class="c1">#  &#39;url&#39;: &#39;&#39;,</span>
<span class="c1">#  &#39;created_at&#39;: 1728673801,</span>
<span class="c1">#  &#39;created_by&#39;: &#39;f6e0b128-c075-4bc3-91da-34d03fa6c67e&#39;,</span>
<span class="c1">#  &#39;completed_at&#39;: None,</span>
<span class="c1">#  &#39;team_id&#39;: &#39;00ccc042-1b41-4f02-ae5f-6a09b5e6e844&#39;,</span>
<span class="c1">#  &#39;restart_count&#39;: 0,</span>
<span class="c1">#  &#39;metadata&#39;: None,</span>
<span class="c1">#  &#39;completion_tokens&#39;: 0,</span>
<span class="c1">#  &#39;prompt_tokens&#39;: 0,</span>
<span class="c1">#  &#39;total_tokens&#39;: 0}</span>
</pre></div>
</div>
<p>After the status changes to <code class="docutils literal notranslate"><span class="pre">COMPLETE</span></code>, you can aggregate the values of all metrics.</p>
<p>To do so, we first download all inputs, outputs, and metric values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">evaluations</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">evaluation_id</span><span class="o">=</span><span class="n">evaluation</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>As an example, let’s print out a question, its generated answer, and the metrics that were computed for it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QUESTION</span><span class="se">\n</span><span class="si">{</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">triggers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ANSWER</span><span class="se">\n</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;METRICS</span><span class="se">\n</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># QUESTION</span>
<span class="c1"># By how much did Pepsico increase its unsecured five year revolving credit agreement on May 26, 2023?</span>
<span class="c1"># ANSWER</span>
<span class="c1"># PepsiCo increased its unsecured five year revolving credit agreement by $400,000,000 on May 26, 2023, going from $3,800,000,000 to $4,200,000,000.</span>
<span class="c1"># METRICS</span>
<span class="c1"># [{&#39;autoredteam.detectors.nlp.BLEU&#39;: 0.0}, {&#39;autoredteam.detectors.nlp.METEOR&#39;: 0.32258064516129037}, {&#39;autoredteam.detectors.nlp.BERTScore&#39;: 0.5262122983517854}, {&#39;autoredteam.detectors.llm.AnswerRelevancy&#39;: 1.0}, {&#39;autoredteam.detectors.llm.ContextualPrecision&#39;: 1.0}, {&#39;autoredteam.detectors.llm.ContextualRecall&#39;: 1.0}, {&#39;autoredteam.detectors.llm.Faithfulness&#39;: 1.0}]</span>
</pre></div>
</div>
<p>Let’s now aggregate across all samples in the dataset and compute the average metrics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># extract metric names</span>
<span class="n">metric_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">met</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># flatten the metrics</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
    <span class="n">metrics</span><span class="p">[</span><span class="n">met</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">met</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metric_names</span><span class="p">):</span>
        <span class="n">metrics</span><span class="p">[</span><span class="n">met</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="n">met</span><span class="p">])</span>
        
<span class="c1"># cleanup and average</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">met</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">metrics</span><span class="p">[</span><span class="n">met</span><span class="p">]</span> <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">}</span>
<span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">metrics_df</span>
<span class="c1"># BLEU                   0.063651</span>
<span class="c1"># METEOR                 0.299480</span>
<span class="c1"># BERTScore              0.501233</span>
<span class="c1"># AnswerRelevancy        0.744167</span>
<span class="c1"># ContextualPrecision    0.975000</span>
<span class="c1"># ContextualRecall       0.766667</span>
<span class="c1"># Faithfulness           0.733975</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
<p>While BLEU and METEOR scores are very low, there is a moderate amount (50%) of semantic overlap between the generated responses and golden answers, as per BERTScore. Per, <code class="docutils literal notranslate"><span class="pre">AnswerRelevancy</span></code>, the generated answers are moderately relevant to the input question. Contextual precision is high, since the benchmark dataset do not contain any contexts relevant to the golden answers. Contextual recall is around 77%, indicating that sometimes the generated answer may not include all information in the contexts. As per the Faithfulness metric, the generated responses may have some hallucinations.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="detections.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Working with Detections</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="owasp.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Testing OWASP LLM Top 10 Vulnerabilities</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Vijil Inc
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Evaluating RAGs through Vijil Evaluate</a><ul>
<li><a class="reference internal" href="#retrieval-metrics">Retrieval Metrics</a></li>
<li><a class="reference internal" href="#generation-metrics">Generation Metrics</a><ul>
<li><a class="reference internal" href="#correctness">Correctness</a></li>
<li><a class="reference internal" href="#relevancy">Relevancy</a></li>
<li><a class="reference internal" href="#hallucination">Hallucination</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evaluating-domain-specific-question-answering">Evaluating Domain-specific Question Answering</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    </body>
</html>